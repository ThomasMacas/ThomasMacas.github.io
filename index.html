<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetMetrics Internet Speed Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        .container {
            text-align: center;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
        }
        #ping-display {
            font-size: 1.5em;
            margin: 20px 0;
            color: #555;
        }
        #start-btn {
            padding: 10px 20px;
            font-size: 1em;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #start-btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NetMetrics Internet Speed Test</h1>
        <input type="text" id="text-input">
        <div id="ping-display">Current Ping: <span id="ping-value">-</span> ms</div>
        <button id="start-btn" onclick="PingURL()">Start Test</button>
    </div>

    <script>
        // Uses FetchAPI to send an HTTP request to given URL and reports server response time
        async function PingURL(){
            const pingDisplay = document.getElementById('ping-value');
            const input = document.getElementById('text-input');

            let url = input.value

            try{
                var startTime = performance.now();  // time before request

                const response = await fetch(url, { method: "HEAD", mode: 'no-cors'});  // FetchAPI call (HTTP request)

                /*
                    CORB will block in response to fetch. It blocks the browser from receiving the response, but the request should
                    be reaching the desired server and coming back before being flagged by CORB (I think). There is probably some
                    overhead involved in the time reported if the previous assumptions are true.
                */

                var endTime = performance.now();    // time after receieved

                if(!response.ok){
                    if(response.status != 0){
                        throw new Error(`Response status: ${response.status}`);     // throw any non-CORB error
                    }
                }

                var ping = endTime - startTime;
                pingDisplay.textContent = ping;
            }
            catch(error){
                // decide what to do with errors
                pingDisplay.textContent = error;
            }
        }

    </script>
</body>
</html>